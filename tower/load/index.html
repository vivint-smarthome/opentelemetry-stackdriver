<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `load` mod in crate `tower`."><meta name="keywords" content="rust, rustlang, rust-lang, load"><title>tower::load - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings"></script><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../tower/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class="location">Module load</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li></ul></div><p class="location"><a href="../index.html">tower</a></p><script>window.sidebarCurrent = {name: "load", ty: "mod", relpath: "../"};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/tower/load/mod.rs.html#1-89" title="goto source code">[src]</a></span><span class="in-band">Module <a href="../index.html">tower</a>::<wbr><a class="mod" href="">load</a></span></h1><div class="docblock"><p>Service load measurement</p>
<p>This module provides the <a href="../../tower/load/trait.Load.html" title="Load"><code>Load</code></a> trait, which allows measuring how loaded a service is.
It also provides several wrapper types that measure load in different ways:</p>
<ul>
<li><a href="../../tower/load/struct.Constant.html" title="Constant"><code>Constant</code></a> — Always returns the same constant load value for a service.</li>
<li><a href="../../tower/load/pending_requests/struct.PendingRequests.html" title="PendingRequests"><code>PendingRequests</code></a> — Measures load by tracking the number of in-flight requests.</li>
<li><a href="../../tower/load/peak_ewma/struct.PeakEwma.html" title="PeakEwma"><code>PeakEwma</code></a> — Measures load using a moving average of the peak latency for the service.</li>
</ul>
<p>In general, you will want to use one of these when using the types in <a href="../../tower/balance/index.html"><code>tower::balance</code></a> which
balance services depending on their load. Which load metric to use depends on your exact
use-case, but the ones above should get you quite far!</p>
<p>When the <code>discover</code> feature is enabled, wrapper types for <a href="../../tower/discover/trait.Discover.html"><code>Discover</code></a> that
wrap the discovered services with the given load estimator are also provided.</p>
<h1 id="when-does-a-request-complete" class="section-header"><a href="#when-does-a-request-complete">When does a request complete?</a></h1>
<p>For many applications, the request life-cycle is relatively simple: when a service responds to
a request, that request is done, and the system can forget about it. However, for some
applications, the service may respond to the initial request while other parts of the system
are still acting on that request. In such an application, the system load must take these
requests into account as well, or risk the system underestimating its own load.</p>
<p>To support these use-cases, the load estimators in this module are parameterized by the
<a href="../../tower/load/completion/trait.TrackCompletion.html" title="TrackCompletion"><code>TrackCompletion</code></a> trait, with <a href="../../tower/load/completion/struct.CompleteOnResponse.html"><code>CompleteOnResponse</code></a> as the default type. The behavior of
<a href="../../tower/load/completion/struct.CompleteOnResponse.html"><code>CompleteOnResponse</code></a> is what you would normally expect for a request-response cycle: when the
response is produced, the request is considered &quot;finished&quot;, and load goes down. This can be
overriden by your own user-defined type to track more complex request completion semantics. See
the documentation for <a href="../../tower/load/completion/index.html" title="completion"><code>completion</code></a> for more details.</p>
<h1 id="examples" class="section-header"><a href="#examples">Examples</a></h1>
<div class="example-wrap"><pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">tower</span>::<span class="ident">util</span>::<span class="ident">ServiceExt</span>;
<span class="kw">use</span> <span class="ident">tower</span>::{<span class="ident">load</span>::<span class="ident">Load</span>, <span class="ident">Service</span>};
<span class="ident">async</span> <span class="kw">fn</span> <span class="ident">simple_balance</span><span class="op">&lt;</span><span class="ident">S1</span>, <span class="ident">S2</span>, <span class="ident">R</span><span class="op">&gt;</span>(
    <span class="ident">svc1</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">S1</span>,
    <span class="ident">svc2</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">S2</span>,
    <span class="ident">request</span>: <span class="ident">R</span>
) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">S1</span>::<span class="ident">Response</span>, <span class="ident">S1</span>::<span class="ident">Error</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">S1</span>: <span class="ident">Load</span> <span class="op">+</span> <span class="ident">Service</span><span class="op">&lt;</span><span class="ident">R</span><span class="op">&gt;</span>,
    <span class="ident">S2</span>: <span class="ident">Load</span><span class="op">&lt;</span><span class="ident">Metric</span> <span class="op">=</span> <span class="ident">S1</span>::<span class="ident">Metric</span><span class="op">&gt;</span> <span class="op">+</span> <span class="ident">Service</span><span class="op">&lt;</span><span class="ident">R</span>, <span class="ident">Response</span> <span class="op">=</span> <span class="ident">S1</span>::<span class="ident">Response</span>, <span class="ident">Error</span> <span class="op">=</span> <span class="ident">S1</span>::<span class="ident">Error</span><span class="op">&gt;</span>
{
    <span class="kw">if</span> <span class="ident">svc1</span>.<span class="ident">load</span>() <span class="op">&lt;</span> <span class="ident">svc2</span>.<span class="ident">load</span>() {
        <span class="ident">svc1</span>.<span class="ident">ready_and</span>().<span class="ident">await</span><span class="question-mark">?</span>.<span class="ident">call</span>(<span class="ident">request</span>).<span class="ident">await</span>
    } <span class="kw">else</span> {
        <span class="ident">svc2</span>.<span class="ident">ready_and</span>().<span class="ident">await</span><span class="question-mark">?</span>.<span class="ident">call</span>(<span class="ident">request</span>).<span class="ident">await</span>
    }
}</pre></div>
</div><h2 id="reexports" class="section-header"><a href="#reexports">Re-exports</a></h2>
<table><tr><td><code>pub use self::completion::<a class="struct" href="../../tower/load/completion/struct.CompleteOnResponse.html" title="struct tower::load::completion::CompleteOnResponse">CompleteOnResponse</a>;</code></td></tr><tr><td><code>pub use self::completion::<a class="trait" href="../../tower/load/completion/trait.TrackCompletion.html" title="trait tower::load::completion::TrackCompletion">TrackCompletion</a>;</code></td></tr><tr><td><code>pub use self::peak_ewma::<a class="struct" href="../../tower/load/peak_ewma/struct.PeakEwma.html" title="struct tower::load::peak_ewma::PeakEwma">PeakEwma</a>;</code></td></tr><tr><td><code>pub use self::pending_requests::<a class="struct" href="../../tower/load/pending_requests/struct.PendingRequests.html" title="struct tower::load::pending_requests::PendingRequests">PendingRequests</a>;</code></td></tr><tr><td><code>pub use self::peak_ewma::<a class="struct" href="../../tower/load/peak_ewma/struct.PeakEwmaDiscover.html" title="struct tower::load::peak_ewma::PeakEwmaDiscover">PeakEwmaDiscover</a>;</code></td></tr><tr><td><code>pub use self::pending_requests::<a class="struct" href="../../tower/load/pending_requests/struct.PendingRequestsDiscover.html" title="struct tower::load::pending_requests::PendingRequestsDiscover">PendingRequestsDiscover</a>;</code></td></tr></table><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<table><tr class="module-item"><td><a class="mod" href="completion/index.html" title="tower::load::completion mod">completion</a></td><td class="docblock-short"><p>Application-specific request completion semantics.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="peak_ewma/index.html" title="tower::load::peak_ewma mod">peak_ewma</a></td><td class="docblock-short"><p>A <code>Load</code> implementation that measures load using the PeakEWMA response latency.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="pending_requests/index.html" title="tower::load::pending_requests mod">pending_requests</a></td><td class="docblock-short"><p>A <a href="../../tower/load/trait.Load.html" title="Load"><code>Load</code></a> implementation that measures load using the number of in-flight requests.</p>
</td></tr></table><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.Constant.html" title="tower::load::Constant struct">Constant</a></td><td class="docblock-short"><p>Wraps a type so that it implements <a href="../../tower/load/trait.Load.html" title="Load"><code>Load</code></a> and returns a constant load metric.</p>
</td></tr></table><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<table><tr class="module-item"><td><a class="trait" href="trait.Load.html" title="tower::load::Load trait">Load</a></td><td class="docblock-short"><p>Types that implement this trait can give an estimate of how loaded they are.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "tower";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>